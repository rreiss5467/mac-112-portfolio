{
  "hash": "4347c5acfc6ca0e93fcdd0e948a8e834",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Joining Data\"\nnumber-sections: true\nexecute: \n  warning: false\nfig-env: 'figure'\nfig-pos: 'h'\nfig-align: center\ncode-fold: false\n---\n\n\n\n\n\n::: {.callout-caution title=\"Learning Goals\"}\n\nUnderstand how to *join* different datasets:\n\n- mutating joins: `left_join()`, `inner_join()` and `full_join()` \n- filtering joins: `semi_join()`, `anti_join()`\n\n:::\n\n::: {.callout-note title=\"Additional Resources\"}\n\nFor more information about the topics covered in this chapter, refer to the resources below:\n\n-   [Demonstration of joining data (YouTube)](https://www.youtube.com/watch?v=MJDHRtwZhoM&feature=youtu.be) by Lisa Lendway\n-   [Joings](https://r4ds.hadley.nz/joins) by Wickham, Çetinkaya-Rundel, & Grolemund\n-   [Data wrangling on multiple tables](https://mdsr-book.github.io/mdsr2e/ch-join.html) by Baumer, Kaplan, and Horton\n\n:::\n\n\n\n\n\n\\\n\\\n\\\n\\\n\n## Warm-up\n\n**Where are we? Data preparation**\n\n![](https://mac-stat.github.io/images/112/legos.png)\n\nThus far, we've learned how to:\n\n-   `arrange()` our data in a meaningful order\n-   subset the data to only `filter()` the rows and `select()` the columns of interest\n-   `mutate()` existing variables and define new variables\n-   `summarize()` various aspects of a variable, both overall and by group (`group_by()`)\n-   reshape our data to fit the task at hand (`pivot_longer()`, `pivot_wider()`)\n\n\\\n\\\n\\\n\\\n\n**Motivation**\n\nIn practice, we often have to collect and combine data from various sources in order to address our research questions. Example:\n\n-   What are the best predictors of album sales?\\\n    Combine:\n    -   Spotify data on individual songs (eg: popularity, genre, characteristics)\n    -   sales data on individual songs\n-   What are the best predictors of flight delays?\\\n    Combine:\n    -   data on individual flights including airline, starting airport, and destination airport\n    -   data on different airlines (eg: ticket prices, reliability, etc)\n    -   data on different airports (eg: location, reliability, etc)\n\n\\\n\\\n\\\n\\\n\n**EXAMPLE 1**\n\nConsider the following (made up) data on students and course enrollments:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudents_1 <- data.frame(\n  student = c(\"A\", \"B\", \"C\"),\n  class = c(\"STAT 101\", \"GEOL 101\", \"ANTH 101\")\n)\n\n# Check it out\nstudents_1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  student    class\n1       A STAT 101\n2       B GEOL 101\n3       C ANTH 101\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nenrollments_1 <- data.frame(\n  class = c(\"STAT 101\", \"ART 101\", \"GEOL 101\"),\n  enrollment = c(18, 17, 24)\n)\n\n# Check it out\nenrollments_1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     class enrollment\n1 STAT 101         18\n2  ART 101         17\n3 GEOL 101         24\n```\n\n\n:::\n:::\n\n\n\n\nOur goal is to *combine* or *join* these datasets into one. For reference, here they are side by side:\n\n![](https://mac-stat.github.io/images/112/join_1.png){width=\"50%\"}\n\nFirst, consider the following:\n\n-   What variable or **key** do these datasets have in common? Thus by what information can we *match* the observations in these datasets?\n\n-   Relative to this key, what info does `students_1` have that `enrollments_1` doesn't?\n\n-   Relative to this key, what info does `enrollments_1` have that `students_1` doesn't?\n\n\\\n\\\n\\\n\\\n\n**EXAMPLE 2**\n\nThere are various ways to join these datasets:\n\n![](https://mac-stat.github.io/images/112/join_1.png){width=\"50%\"}\n\nLet's learn by doing. First, try the `left_join()` function:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nstudents_1 |> \n  left_join(enrollments_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  student    class enrollment\n1       A STAT 101         18\n2       B GEOL 101         24\n3       C ANTH 101         NA\n```\n\n\n:::\n:::\n\n\n\n\n-   What did this do? What are the roles of `students_1` (the *left* table) and `enrollments_1` (the *right* table)?\n\n-   What, if anything, would change if we reversed the order of the data tables? Think about it, then try.\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n**EXAMPLE 3**\n\nNext, explore how our datasets are joined using `inner_join()`:\n\n![](https://mac-stat.github.io/images/112/join_1.png){width=\"50%\"}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudents_1 |> \n  inner_join(enrollments_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  student    class enrollment\n1       A STAT 101         18\n2       B GEOL 101         24\n```\n\n\n:::\n:::\n\n\n\n\n-   What did this do? What are the roles of `students_1` (the *left* table) and `enrollments_1` (the *right* table)?\n\n-   What, if anything, would change if we reversed the order of the data tables? Think about it, then try.\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n**EXAMPLE 4**\n\nNext, explore how our datasets are joined using `full_join()`:\n\n![](https://mac-stat.github.io/images/112/join_1.png){width=\"50%\"}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudents_1 |> \n  full_join(enrollments_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  student    class enrollment\n1       A STAT 101         18\n2       B GEOL 101         24\n3       C ANTH 101         NA\n4    <NA>  ART 101         17\n```\n\n\n:::\n:::\n\n\n\n\n-   What did this do? What are the roles of `students_1` (the *left* table) and `enrollments_1` (the *right* table)?\n\n-   What, if anything, would change if we reversed the order of the data tables? Think about it, then try.\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n**Mutating joins: left, inner, full**\n\nMutating joins add new variables (columns) to the left data table from matching observations in the right table:\n\n`left_data |> mutating_join(right_data)`\n\nThe most common mutating joins are:\n\n-   `left_join()`\\\n    Keeps *all* observations from the left, but discards any observations in the right that do not have a match in the left.[^11-joining-data-1]\n\n-   `inner_join()`\\\n    Keeps *only* the observations from the left with a match in the right.\n\n-   `full_join()`\\\n    Keeps *all* observations from the left *and* the right. (This is less common than `left_join()` and `inner_join()`).\n\n[^11-joining-data-1]: There is also a `right_join()` that adds variables in the reverse direction from the left table to the right table, but we do not really need it as we can always switch the roles of the two tables.︎\n\nNOTE: When an observation in the left table has *multiple* matches in the right table, these mutating joins produce a *separate* observation in the new table for each match.\n\n\\\n\\\n\\\n\\\n\n**EXAMPLE 5**\n\n*Mutating* joins *combine* information, thus increase the number of columns in a dataset (like `mutate()`). *Filtering* joins keep only certain observations in one dataset (like `filter()`), not based on rules related to any variables in the dataset, but on the observations that exist in another dataset. This is useful when we merely care about the membership or non-membership of an observation in the other dataset, not the raw data itself.\n\nIn our example data, suppose `enrollments_1` only included courses being taught in the Theater building:\n\n![](https://mac-stat.github.io/images/112/join_1.png){width=\"50%\"}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudents_1 |> \n  semi_join(enrollments_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  student    class\n1       A STAT 101\n2       B GEOL 101\n```\n\n\n:::\n:::\n\n\n\n\n-   What did this do? What info would it give us?\n\n-   How does `semi_join()` differ from `inner_join()`?\n\n-   What, if anything, would change if we reversed the order of the data tables? Think about it, then try.\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n**EXAMPLE 6**\n\nLet's try another filtering join for our example data:\n\n![](https://mac-stat.github.io/images/112/join_1.png){width=\"50%\"}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudents_1 |> \n  anti_join(enrollments_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  student    class\n1       C ANTH 101\n```\n\n\n:::\n:::\n\n\n\n\n-   What did this do? What info would it give us?\n\n-   What, if anything, would change if we reversed the order of the data tables? Think about it, then try.\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n**Filtering joins: semi, anti**\n\nFiltering joins keep specific observations from the left table based on whether they match an observation in the right table.\n\n-   `semi_join()`\\\n    Discards any observations in the left table that *do not* have a match in the right table. If there are multiple matches of right cases to a left case, it keeps just one copy of the left case.\n\n-   `anti_join()`\\\n    Discards any observations in the left table that *do* have a match in the right table.\n\n\\\n\\\n\\\n\\\n\\\n\\\n\n**A SUMMARY OF ALL OF OUR JOINS**\n\n![](https://mac-stat.github.io/images/112/join_summary.png)\n\n\\\n\\\n\\\n\\\n\\\n\n## Exercises\n\n\n### Exercise 1: Where are my keys? {.unnumbered}\n\n#### Part a {.unnumbered}\n\nDefine two new datasets, with different students and courses:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nstudents_2 <- data.frame(\n  student = c(\"D\", \"E\", \"F\"),\n  class = c(\"COMP 101\", \"BIOL 101\", \"POLI 101\")\n)\n\n# Check it out\nstudents_2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  student    class\n1       D COMP 101\n2       E BIOL 101\n3       F POLI 101\n```\n\n\n:::\n\n```{.r .cell-code}\nenrollments_2 <- data.frame(\n  course = c(\"ART 101\", \"BIOL 101\", \"COMP 101\"),\n  enrollment = c(18, 20, 19)\n)\n\n# Check it out\nenrollments_2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    course enrollment\n1  ART 101         18\n2 BIOL 101         20\n3 COMP 101         19\n```\n\n\n:::\n:::\n\n\n\n\nTo connect the course enrollments to the students' courses, try do a `left_join()`. You get an error! Identify the problem by reviewing the error message and the datasets we're trying to join.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# eval = FALSE: don't evaluate this chunk when knitting. it produces an error.\nstudents_2 |> \n  left_join(enrollments_2)\n```\n:::\n\n\n\n\n#### Part b {.unnumbered}\n\nThe problem is that course name, the **key** or variable that links these two datasets, is labeled differently: `class` in the `students_2` data and `course` in the `enrollments_2` data. Thus we have to specify these keys in our code:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudents_2 |> \n  left_join(enrollments_2, by = c(\"class\" = \"course\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  student    class enrollment\n1       D COMP 101         19\n2       E BIOL 101         20\n3       F POLI 101         NA\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# The order of the keys is important:\n# by = c(\"left data key\" = \"right data key\")\n# The order is mixed up here, thus we get an error:\nstudents_2 |> \n  left_join(enrollments_2, by = c(\"course\" = \"class\"))\n```\n:::\n\n\n\n\n#### Part c {.unnumbered}\n\nDefine another set of fake data which adds grade information:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add student grades in each course\nstudents_3 <- data.frame(\n  student = c(\"Y\", \"Y\", \"Z\", \"Z\"),\n  class = c(\"COMP 101\", \"BIOL 101\", \"POLI 101\", \"COMP 101\"),\n  grade = c(\"B\", \"S\", \"C\", \"A\")\n)\n\n# Check it out\nstudents_3\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  student    class grade\n1       Y COMP 101     B\n2       Y BIOL 101     S\n3       Z POLI 101     C\n4       Z COMP 101     A\n```\n\n\n:::\n\n```{.r .cell-code}\n# Add average grades in each course\nenrollments_3 <- data.frame(\n  class = c(\"ART 101\", \"BIOL 101\",\"COMP 101\"),\n  grade = c(\"B\", \"A\", \"A-\"),\n  enrollment = c(20, 18, 19)\n)\n\n# Check it out\nenrollments_3\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     class grade enrollment\n1  ART 101     B         20\n2 BIOL 101     A         18\n3 COMP 101    A-         19\n```\n\n\n:::\n:::\n\n\n\n\nTry doing a `left_join()` to link the students' classes to their enrollment info. Did this work? Try and figure out the culprit by examining the output.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudents_3 |> \n  left_join(enrollments_3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  student    class grade enrollment\n1       Y COMP 101     B         NA\n2       Y BIOL 101     S         NA\n3       Z POLI 101     C         NA\n4       Z COMP 101     A         NA\n```\n\n\n:::\n:::\n\n\n\n\n#### Part d {.unnumbered}\n\nThe issue here is that our datasets have *2* column names in common: `class` and `grade`. BUT `grade` is measuring 2 different things here: individual student grades in `students_3` and average student grades in `enrollments_3`. Thus it doesn't make sense to try to join the datasets with respect to this variable. We can again solve this by specifying that we want to join the datasets using the `class` variable or *key*. What are `grade.x` and `grade.y`?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudents_3 |> \n  left_join(enrollments_3, by = c(\"class\" = \"class\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  student    class grade.x grade.y enrollment\n1       Y COMP 101       B      A-         19\n2       Y BIOL 101       S       A         18\n3       Z POLI 101       C    <NA>         NA\n4       Z COMP 101       A      A-         19\n```\n\n\n:::\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n### Exercise 2: More small practice {.unnumbered}\n\nBefore applying these ideas to bigger datasets, let's practice identifying which join is appropriate in different scenarios. Define the following fake data on `voters` (people who *have* voted) and `contact` info for voting age adults (people who *could* vote):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# People who have voted\nvoters <- data.frame(\n  id = c(\"A\", \"D\", \"E\", \"F\", \"G\"),\n  times_voted = c(2, 4, 17, 6, 20)\n)\n\nvoters\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id times_voted\n1  A           2\n2  D           4\n3  E          17\n4  F           6\n5  G          20\n```\n\n\n:::\n\n```{.r .cell-code}\n# Contact info for voting age adults\ncontact <- data.frame(\n  name = c(\"A\", \"B\", \"C\", \"D\"),\n  address = c(\"summit\", \"grand\", \"snelling\", \"fairview\"),\n  age = c(24, 89, 43, 38)\n)\n\ncontact\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  name  address age\n1    A   summit  24\n2    B    grand  89\n3    C snelling  43\n4    D fairview  38\n```\n\n\n:::\n:::\n\n\n\n\nUse the appropriate join for each prompt below. In each case, think before you type:\n\n-   What dataset goes on the left?\n-   What do you want the resulting dataset to look like? How many rows and columns will it have?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. We want contact info for people who HAVEN'T voted\ncontact %>% \n  left_join(voters, by = c(\"name\" = \"id\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  name  address age times_voted\n1    A   summit  24           2\n2    B    grand  89          NA\n3    C snelling  43          NA\n4    D fairview  38           4\n```\n\n\n:::\n\n```{.r .cell-code}\n# 2. We want contact info for people who HAVE voted\ncontact %>% \n  left_join(voters, by = c(\"name\" = \"id\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  name  address age times_voted\n1    A   summit  24           2\n2    B    grand  89          NA\n3    C snelling  43          NA\n4    D fairview  38           4\n```\n\n\n:::\n\n```{.r .cell-code}\n# 3. We want any data available on each person\ncontact %>% \n  full_join(voters, by = c(\"name\" = \"id\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  name  address age times_voted\n1    A   summit  24           2\n2    B    grand  89          NA\n3    C snelling  43          NA\n4    D fairview  38           4\n5    E     <NA>  NA          17\n6    F     <NA>  NA           6\n7    G     <NA>  NA          20\n```\n\n\n:::\n\n```{.r .cell-code}\n# 4. When possible, we want to add contact info to the voting roster\nvoters %>% \n  left_join(contact, by = c(\"id\" = \"name\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id times_voted  address age\n1  A           2   summit  24\n2  D           4 fairview  38\n3  E          17     <NA>  NA\n4  F           6     <NA>  NA\n5  G          20     <NA>  NA\n```\n\n\n:::\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n### Exercise 3: Bigger datasets {.unnumbered}\n\nLet's apply these ideas to some bigger datasets. In `grades`, each row is a student-class pair with information on:\n\n-   `sid` = student ID\n-   `grade` = student's grade\n-   `sessionID` = an identifier of the class section\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n     sid grade   sessionID\n1 S31185    D+ session1784\n2 S31185    B+ session1785\n3 S31185    A- session1791\n4 S31185    B+ session1792\n5 S31185    B- session1794\n6 S31185    C+ session1795\n```\n\n\n:::\n:::\n\n\n\n\nIn `courses`, each row corresponds to a class section with information on:\n\n-   `sessionID` = an identifier of the class section\n-   `dept` = department\n-   `level` = course level (eg: 100)\n-   `sem` = semester\n-   `enroll` = enrollment (number of students)\n-   `iid` = instructor ID\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n    sessionID dept level    sem enroll     iid\n1 session1784    M   100 FA1991     22 inst265\n2 session1785    k   100 FA1991     52 inst458\n3 session1791    J   100 FA1993     22 inst223\n4 session1792    J   300 FA1993     20 inst235\n5 session1794    J   200 FA1993     22 inst234\n6 session1795    J   200 SP1994     26 inst230\n```\n\n\n:::\n:::\n\n\n\n\nUse R code to take a quick glance at the data.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# How many observations (rows) and variables (columns) are there in the grades data?\ndim(grades)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5844    3\n```\n\n\n:::\n\n```{.r .cell-code}\n# How many observations (rows) and variables (columns) are there in the courses data?\ndim(courses)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1718    6\n```\n\n\n:::\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n### Exercise 4: Class size {.unnumbered}\n\nHow big are the classes?\n\n#### Part a {.unnumbered}\n\nBefore digging in, note that some courses are listed twice in the `courses` data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncourses |> \n  count(sessionID) |> \n  filter(n > 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     sessionID n\n1  session2047 2\n2  session2067 2\n3  session2448 2\n4  session2509 2\n5  session2541 2\n6  session2824 2\n7  session2826 2\n8  session2862 2\n9  session2897 2\n10 session3046 2\n11 session3057 2\n12 session3123 2\n13 session3243 2\n14 session3257 2\n15 session3387 2\n16 session3400 2\n17 session3414 2\n18 session3430 2\n19 session3489 2\n20 session3524 2\n21 session3629 2\n22 session3643 2\n23 session3821 2\n```\n\n\n:::\n:::\n\n\n\n\nIf we pick out just 1 of these, we learn that some courses are cross-listed in multiple departments:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncourses |> \n  filter(sessionID == \"session2047\")\n```\n:::\n\n\n\n\nFor our class size exploration, obtain the *total* enrollments in each `sessionID`, combining any cross-listed sections. Save this as `courses_combined`. NOTE: There's no joining to do here!\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncourses_combined <- courses |> \n   group_by(sessionID) |> \n   summarize(enroll = sum(enroll))\n\n# Check that this has 1695 rows and 2 columns\n dim(courses_combined)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1695    2\n```\n\n\n:::\n:::\n\n\n\n\n#### Part b {.unnumbered}\n\nLet's first examine the question of class size from the *administration*'s viewpoint. To this end, calculate the median class size across all class sections. (The median is the *middle* or 50th percentile. Unlike the *mean*, it's not skewed by outliers.) THINK FIRST:\n\n-   Which of the 2 datasets do you need to answer this question? One? Both?\n-   If you need course information, use `courses_combined` not `courses`.\n-   Do you have to do any joining? If so, which dataset will go on the left, i.e. which dataset includes your primary observations of interest? Which join function will you need?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncourses_combined %>% \n  summarize(median(enroll))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 1\n  `median(enroll)`\n             <int>\n1               18\n```\n\n\n:::\n:::\n\n\n\n\n#### Part c {.unnumbered}\n\nBut how big are classes from the student perspective? To this end, calculate the median class size for each individual student. Once you have the correct output, store it as `student_class_size`. THINK FIRST:\n\n-   Which of the 2 datasets do you need to answer this question? One? Both?\n-   If you need course information, use `courses_combined` not `courses`.\n-   Do you have to do any joining? If so, which dataset will go on the left, i.e. which dataset includes your primary observations of interest? Which join function will you need?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudent_class_size <- grades %>% \n  left_join(courses_combined) %>% \n  group_by(sid) %>% \n  summarize(med_class=median(enroll))\n\nhead(student_class_size)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 2\n  sid    med_class\n  <chr>      <dbl>\n1 S31185      23.5\n2 S31188      21  \n3 S31191      25  \n4 S31194      15  \n5 S31197      24  \n6 S31200      21  \n```\n\n\n:::\n:::\n\n\n\n\n#### Part d {.unnumbered}\n\nThe median class size varies from student to student. To get a sense for the typical student experience and range in student experiences, construct and discuss a histogram of the median class sizes experienced by the students.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(student_class_size, aes(x = med_class)) + \n   geom_histogram()\n```\n\n::: {.cell-output-display}\n![](activity_11_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n### Exercise 5: Narrowing in on classes {.unnumbered}\n\n#### Part a {.unnumbered}\n\nShow data on the students that enrolled in `session1986`. THINK FIRST: Which of the 2 datasets do you need to answer this question? One? Both?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrades %>% \n  filter(sessionID == \"session1986\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     sid grade   sessionID\n1 S31401    B+ session1986\n2 S32247     B session1986\n```\n\n\n:::\n:::\n\n\n\n\n#### Part b {.unnumbered}\n\nBelow is a dataset with all courses in department E:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndept_E <- courses |> \n  filter(dept == \"E\")\n```\n:::\n\n\n\n\nWhat students enrolled in classes in department E? (We just want info on the students, not the classes.)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrades %>% \n  semi_join(dept_E)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n      sid grade   sessionID\n1  S31245     A session2326\n2  S31470     B session3658\n3  S31470     B session3798\n4  S31470     A session3799\n5  S31938     A session2326\n6  S31968     A session3104\n7  S32022     A session3798\n8  S32046    A- session2326\n9  S32226     A session2326\n10 S32415     B session2835\n11 S32415    B+ session3799\n12 S32484    A- session3658\n```\n\n\n:::\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n### Exercise 6: All the wrangling {.unnumbered}\n\nUse all of your wrangling skills to answer the following prompts! THINK FIRST:\n\n-   Think about what tables you might need to join (if any). Identify the corresponding variables to match.\n-   You'll need an extra table to convert grades to grade point averages:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngpa_conversion <- tibble(\n  grade = c(\"A+\", \"A\", \"A-\", \"B+\", \"B\", \"B-\", \"C+\", \"C\", \"C-\", \"D+\", \"D\", \"D-\", \"NC\", \"AU\", \"S\"), \n  gp = c(4.3, 4, 3.7, 3.3, 3, 2.7, 2.3, 2, 1.7, 1.3, 1, 0.7, 0, NA, NA)\n)\n\ngpa_conversion\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 15 × 2\n   grade    gp\n   <chr> <dbl>\n 1 A+      4.3\n 2 A       4  \n 3 A-      3.7\n 4 B+      3.3\n 5 B       3  \n 6 B-      2.7\n 7 C+      2.3\n 8 C       2  \n 9 C-      1.7\n10 D+      1.3\n11 D       1  \n12 D-      0.7\n13 NC      0  \n14 AU     NA  \n15 S      NA  \n```\n\n\n:::\n:::\n\n\n\n\n#### Part a {.unnumbered}\n\nHow many total student enrollments are there in each department? Order from high to low.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncourses %>% \n  group_by(dept) %>% \n  summarize(total = sum(enroll)) %>% \n  arrange(desc(total))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 40 × 2\n   dept  total\n   <chr> <int>\n 1 d      3046\n 2 j      2312\n 3 O      2178\n 4 M      2129\n 5 m      2105\n 6 D      2003\n 7 W      1960\n 8 q      1859\n 9 k      1824\n10 F      1587\n# ℹ 30 more rows\n```\n\n\n:::\n:::\n\n\n\n\n#### Part b {.unnumbered}\n\nWhat's the grade-point average (GPA) for each student?\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n#### Part c {.unnumbered}\n\nWhat's the median GPA across all students?\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n#### Part d {.unnumbered}\n\nWhat fraction of grades are below B+?\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n#### Part e {.unnumbered}\n\nWhat's the grade-point average for each instructor? Order from low to high.\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n#### Part f {.unnumbered}\n\nCHALLENGE: Estimate the grade-point average for each department, and sort from low to high. NOTE: Don't include cross-listed courses. Students in cross-listed courses could be enrolled under either department, and we do not know which department to assign the grade to. HINT: You'll need to do multiple joins.\n\n\\\n\\\n\\\n\\\n\n### Exercise 7: HOMEWORK PRACTICE {.unnumbered}\n\nThis exercise is on Homework 4, thus no solutions are provided. In Homework 4, you'll be working with the `Birthdays` data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mosaic)\ndata(\"Birthdays\")\nhead(Birthdays)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  state year month day       date wday births\n1    AK 1969     1   1 1969-01-01  Wed     14\n2    AL 1969     1   1 1969-01-01  Wed    174\n3    AR 1969     1   1 1969-01-01  Wed     78\n4    AZ 1969     1   1 1969-01-01  Wed     84\n5    CA 1969     1   1 1969-01-01  Wed    824\n6    CO 1969     1   1 1969-01-01  Wed    100\n```\n\n\n:::\n:::\n\n\n\n\nYou'll also be exploring how the number of daily births is (or isn't!) related to holidays. To this end, import data on U.S. federal holidays [here](data/US-Holidays.csv). NOTE: `lubridate::dmy()` converts the character-string date stored in the CSV to a \"POSIX\" date-number.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nholidays <- read.csv(\"https://mac-stat.github.io/data/US-Holidays.csv\") |>\n  mutate(date = as.POSIXct(lubridate::dmy(date)))\n```\n:::\n\n\n\n\n#### Part a {.unnumbered}\n\nCreate a new dataset, `daily_births_1980`, which:\n\n-   keeps only `daily_births` related to **1980**\n-   adds a variable called `is_holiday` which is `TRUE` when the day is a holiday, and `FALSE` otherwise. NOTE: `!is.na(x)` is `TRUE` if column `x` is *not* NA, and `FALSE` if it is NA.\n\nPrint out the first 6 rows and confirm that your dataset has 366 rows (1 per day in 1980) and 7 columns. HINT: You'll need to combine 2 different datasets.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define daily_births_1980\n\n\n# Check out the first 6 rows\n\n\n# Confirm that daily_births_1980 has 366 rows and 7 columns\n```\n:::\n\n\n\n\n#### Part b {.unnumbered}\n\nPlot the total number of babies born (y-axis) per day (x-axis) in 1980. Color each date according to its day of the week, and `shape` each date according to whether or not it's a holiday. (This is a modified version of 3c!)\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n#### Part c {.unnumbered}\n\nDiscuss your observations. For example: To what degree does the theory that there tend to be fewer births on holidays hold up? What holidays stand out the most?\n\n#### Part d (OPTIONAL) {.unnumbered}\n\nSome holidays stand out more than others. It would be helpful to label them. Use `geom_text` to add labels to each of the holidays. NOTE: You can set the orientation of a label with the `angle` argument; e.g., `geom_text(angle = 40, ...)`.\n\n\\\n\\\n\\\n\\\n\n### Next steps {.unnumbered}\n\nIf you finish this all during class, you're expected to work on Homework 4. If you're done with Homework 4, you're expected to play around with more TidyTuesday data. Mainly, and naturally, you're expected to spend 112 class time on 112 :)\n\n\\\n\\\n\\\n\\\n\n\n## Solutions\n\n<details>\n\n<summary>Click for Solutions</summary>\n\n**EXAMPLE 1**\n\na.  class\nb.  a student that took ANTH 101\nc.  data on ART 101\n\n\\\n\\\n\n**EXAMPLE 2**\n\n-   What did this do? Linked course info to all students in `students_1`\n-   Which observations from `students_1` (the *left* table) were retained? All of them.\n-   Which observations from `enrollments_1` (the *right* table) were retained? Only STAT and GEOL, those that matched the students.\n-   What, if anything, would change if we reversed the order of the data tables? Think about it, then try. We retain the courses, not students.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nenrollments_1 |> \n  left_join(students_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     class enrollment student\n1 STAT 101         18       A\n2  ART 101         17    <NA>\n3 GEOL 101         24       B\n```\n\n\n:::\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n**EXAMPLE 3**\n\n-   Which observations from `students_1` (the *left* table) were retained? A and B, only those with enrollment info.\n\n-   Which observations from `enrollments_1` (the *right* table) were retained? STAT and GEOL, only those with studen info.\n\n-   What, if anything, would change if we reversed the order of the data tables? Think about it, then try. Same info, different column order.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nenrollments_1 |> \n    inner_join(students_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     class enrollment student\n1 STAT 101         18       A\n2 GEOL 101         24       B\n```\n\n\n:::\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n**EXAMPLE 4**\n\n-   Which observations from `students_1` (the *left* table) were retained? All\n-   Which observations from `enrollments_1` (the *right* table) were retained? All\n-   What, if anything, would change if we reversed the order of the data tables? Think about it, then try. Same data, different order.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nenrollments_1 |> \n    full_join(students_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     class enrollment student\n1 STAT 101         18       A\n2  ART 101         17    <NA>\n3 GEOL 101         24       B\n4 ANTH 101         NA       C\n```\n\n\n:::\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n**EXAMPLE 5**\n\n-   Which observations from `students_1` (the *left* table) were retained? Only those with enrollment info.\n-   Which observations from `enrollments_1` (the *right* table) were retained? None.\n-   What, if anything, would change if we reversed the order of the data tables? Think about it, then try. Same data, different order.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nenrollments_1 |> \n  semi_join(students_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     class enrollment\n1 STAT 101         18\n2 GEOL 101         24\n```\n\n\n:::\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n**EXAMPLE 6**\n\n-   Which observations from `students_1` (the *left* table) were retained? Only C, the one *without* enrollment info.\n-   Which observations from `enrollments_1` (the *right* table) were retained? None.\n-   What, if anything, would change if we reversed the order of the data tables? Think about it, then try. Retain only ART 101, the course with no student info.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nenrollments_1 |> \n  anti_join(students_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    class enrollment\n1 ART 101         17\n```\n\n\n:::\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n### Exercise 2: More small practice {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. We want contact info for people who HAVEN'T voted\ncontact |> \n  anti_join(voters, by = c(\"name\" = \"id\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  name  address age\n1    B    grand  89\n2    C snelling  43\n```\n\n\n:::\n\n```{.r .cell-code}\n# 2. We want contact info for people who HAVE voted\ncontact |> \n  semi_join(voters, by = c(\"name\" = \"id\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  name  address age\n1    A   summit  24\n2    D fairview  38\n```\n\n\n:::\n\n```{.r .cell-code}\n# 3. We want any data available on each person\ncontact |> \n  full_join(voters, by = c(\"name\" = \"id\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  name  address age times_voted\n1    A   summit  24           2\n2    B    grand  89          NA\n3    C snelling  43          NA\n4    D fairview  38           4\n5    E     <NA>  NA          17\n6    F     <NA>  NA           6\n7    G     <NA>  NA          20\n```\n\n\n:::\n\n```{.r .cell-code}\nvoters |> \n  full_join(contact, by = c(\"id\" = \"name\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id times_voted  address age\n1  A           2   summit  24\n2  D           4 fairview  38\n3  E          17     <NA>  NA\n4  F           6     <NA>  NA\n5  G          20     <NA>  NA\n6  B          NA    grand  89\n7  C          NA snelling  43\n```\n\n\n:::\n\n```{.r .cell-code}\n# 4. We want to add contact info, when possible, to the voting roster\nvoters |> \n  left_join(contact, by = c(\"id\" = \"name\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id times_voted  address age\n1  A           2   summit  24\n2  D           4 fairview  38\n3  E          17     <NA>  NA\n4  F           6     <NA>  NA\n5  G          20     <NA>  NA\n```\n\n\n:::\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n### Exercise 3: Bigger datasets {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# How many observations (rows) and variables (columns) are there in the grades data?\ndim(grades)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 5844    3\n```\n\n\n:::\n\n```{.r .cell-code}\n# How many observations (rows) and variables (columns) are there in the courses data?\ndim(courses)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1718    6\n```\n\n\n:::\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n### Exercise 4: Class size {.unnumbered}\n\n#### Part a {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncourses_combined <- courses |>\n  group_by(sessionID) |>\n  summarize(enroll = sum(enroll))\n\n# Check that this has 1695 rows and 2 columns\ndim(courses_combined)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1695    2\n```\n\n\n:::\n:::\n\n\n\n\n#### Part b {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncourses_combined |> \n  summarize(median(enroll))\n```\n:::\n\n\n\n\n#### Part c {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudent_class_size <- grades |> \n  left_join(courses_combined) |> \n  group_by(sid) |> \n  summarize(med_class = median(enroll))\n\nhead(student_class_size)\n```\n:::\n\n\n\n\n#### Part d {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(student_class_size, aes(x = med_class)) +\n  geom_histogram(color = \"white\")\n```\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n### Exercise 5: Narrowing in on classes {.unnumbered}\n\n#### Part a {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrades |> \n  filter(sessionID == \"session1986\")\n```\n:::\n\n\n\n\n#### Part b {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrades |> \n  semi_join(dept_E)\n```\n:::\n\n\n\n\n\\\n\\\n\\\n\\\n\n### Exercise 6: All the wrangling {.unnumbered}\n\n#### Part a {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncourses |> \n  group_by(dept) |> \n  summarize(total = sum(enroll)) |> \n  arrange(desc(total))\n```\n:::\n\n\n\n\n#### Part b {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrades |> \n  left_join(gpa_conversion) |> \n  group_by(sid) |> \n  summarize(mean(gp, na.rm = TRUE))\n```\n:::\n\n\n\n\n#### Part c {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrades |> \n  left_join(gpa_conversion) |> \n  group_by(sid) |> \n  summarize(gpa = mean(gp, na.rm = TRUE)) |> \n  summarize(median(gpa))\n```\n:::\n\n\n\n\n#### Part d {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# There are lots of approaches here!\ngrades |> \n  left_join(gpa_conversion) |> \n  mutate(below_b_plus = (gp < 3.3)) |> \n  summarize(mean(below_b_plus, na.rm = TRUE))\n```\n:::\n\n\n\n\n#### Part e {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrades |> \n  left_join(gpa_conversion) |> \n  left_join(courses) |> \n  group_by(iid) |> \n  summarize(gpa = mean(gp, na.rm = TRUE)) |> \n  arrange(gpa)\n```\n:::\n\n\n\n\n#### Part f {.unnumbered}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncross_listed <- courses |> \n  count(sessionID) |> \n  filter(n > 1)\n\ngrades |> \n  anti_join(cross_listed) |> \n  inner_join(courses) |> \n  left_join(gpa_conversion) |> \n  group_by(dept) |> \n  summarize(gpa = mean(gp, na.rm = TRUE)) |> \n  arrange(gpa)\n```\n:::\n\n\n\n\n</details>\n",
    "supporting": [
      "activity_11_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}